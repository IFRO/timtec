{% extends "messages.html" %}
{% load i18n %}
{% load is_assistant_or_coordinator %}
{% load timtec_markdown %}

{% block message-title-tag %}
    <div class="col-xs-12">
        <h1>{% trans "Message" %}</h1>
    </div>
{% endblock %}

{% block message-button-new %}{% endblock %}

{% block messages_content %}
    <div class="message" ng-controller="MessageController">

        <div class="col-xs-12" ng-hide="message.$resolved">
            <div class="waiting textcenter">
                <div class="middle">
                    <i class="fa fa-refresh fa-5x"></i>
                </div>
            </div>
        </div>

        <div ng-show="message.$resolved">
            {% verbatim %}
            <h1 class="bottom">{{ message.subject }}</h1>
            <p class="date">{{ message.date|date:"dd/MM/yy" }}</p>
            {% endverbatim %}

            <hr />
            <div class="body">
                <span ng-bind-html="message.message"> </span>
            </div>

            {% verbatim %}
                <div class="body" ng-repeat="answer in message.answers" ng-attr-title="{{answer.date|date:'dd/MM/yy HH:mm'}}">
                    <hr>
                    <strong>{{answer.user_fullname}}: </strong>
                    <span ng-bind-html="answer.text"></span>
                </div>
            {% endverbatim %}


            <hr />


            {% if user|is_assistant_or_coordinator:course %}
                <div class="message-answer">
                    <h2>{% trans 'Respond' %}</h2>
                    <div class="alert alert-danger" role="alert" ng-if="new_answer_validation_error">
                        <ul>
                            <li><a href="#wmd-input"></a></li>
                        </ul>
                    </div>
                    <div class="form-group text-editor">
                        <div class="wmd-panel" markdowneditor="true">
                            <div id="wmd-button-bar" class="js-button-bar"></div>
                            <textarea ng-model="new_answer" class="form-control" id="wmd-input" rows="10"></textarea>
                        </div>
                    </div>
                    <div class="form-group textright bottom">
                        <button ng-click="answer_message()" class="btn btn-success">{% trans 'Send' %}</button>
                    </div>
                </div>
                <hr />
                <div class='btn btn-primary' ng-hide="show_recipients" ng-click="toggle_recipient_list()">{% trans "Show Recipient List" %}</div>
                <div class='btn btn-primary' ng-hide="!show_recipients" ng-click="toggle_recipient_list()">{% trans "Hide Recipient List" %}</div>

                <div class="row" ng-hide="!show_recipients">
                    <div class="students col-lg-12">
                        <h2>{% trans 'Recipients' %}</h2>
                        <table class="table table-list">
                            <tr>
                                <th class="fullname">{% trans "Full name" %}</th>
                                <th class="email">{% trans "Email" %}</th>
                                <th class="username">{% trans "Username" %}</th>
                            </tr>
                            <tr ng-repeat="student in message.users_details">
                                {% verbatim %}
                                <td>{{student.name}}</td>
                                <td>{{student.email}}</td>
                                <td>{{student.username}}</td>
                                {% endverbatim %}
                            </tr>
                        </table>
                    </div>
                </div>
            {% else %}
                <div class="message-answer">
                    <h2>{% trans 'Respond' %}</h2>
                    <div class="alert alert-danger" role="alert" ng-if="new_answer_validation_error">
                        <ul>
                            <li><a href="#wmd-input"></a></li>
                        </ul>
                    </div>
                    <div class="form-group text-editor">
                        <div class="wmd-panel" markdowneditor="true">
                            <div id="wmd-button-bar" class="js-button-bar"></div>
                            <textarea ng-model="new_answer" class="form-control" id="wmd-input" rows="10"></textarea>
                        </div>
                    </div>
                    <div class="form-group textright bottom">
                        <button ng-click="answer_as_new_message()" class="btn btn-success">{% trans 'Send' %}</button>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
